{"version":3,"file":"index.umd.js","sources":["../lib/key-enum.ts","../lib/index.tsx"],"sourcesContent":["export enum KeyEnum {\n  TAB = 'Tab',\n  ENTER = 'Enter',\n  ARROW_UP = 'ArrowUp',\n  ARROW_DOWN = 'ArrowDown',\n}\n","import React, { useRef, useState } from 'react';\nimport classNames from 'classnames';\nimport ignoreCase from 'ignore-case';\nimport { KeyEnum } from './key-enum';\nimport styles from './index.module.css';\n\nexport interface Props {\n  value?: string;\n  dataSource: DataSourceItem[];\n  className?: string;\n  style?: React.CSSProperties;\n  placeholder?: string;\n  disabled?: boolean;\n  navigate?: boolean;\n  caseSensitive?: boolean;\n  onBlur?: () => void;\n  onFocus?: () => void;\n  onChange?: (value: string) => void;\n  onPressEnter?: (value: string) => void;\n  onSelect?: (item: DataSourceItem) => void;\n}\n\nexport interface DataSourceItem {\n  text: string;\n  value: string | number;\n  [key: string]: any;\n}\n\nconst Autocomplete: React.ForwardRefRenderFunction<HTMLInputElement, Props> = (props, ref) => {\n  const {\n    value,\n    dataSource,\n    className,\n    navigate = true,\n    caseSensitive = true,\n    onBlur,\n    onFocus,\n    onChange,\n    onPressEnter,\n    onSelect,\n    ...others\n  } = props;\n  const [innerVal, setInnerVal] = useState('');\n  const [matchedDataSource, setMatchedDataSource] = useState<DataSourceItem[]>();\n  const [activeIndex, setActiveIndex] = useState(0);\n  const ctrlValue = value ?? innerVal;\n\n  /**\n   * inputRef\n   */\n  const inputRef = useRef<HTMLInputElement>();\n  React.useImperativeHandle(ref, () => inputRef.current!);\n\n  const updateValue = (value: string) => {\n    onChange && onChange(value);\n    setInnerVal(value);\n  };\n\n  const updateMatchedDataSource = (value?: string) => {\n    setActiveIndex(0);\n    value\n      ? setMatchedDataSource(\n          dataSource.filter(({ text }) => {\n            return caseSensitive\n              ? text.startsWith(value) && text !== value\n              : ignoreCase.startsWith(text, value) && !ignoreCase.equals(text, value);\n          })\n        )\n      : setMatchedDataSource([]);\n  };\n\n  /**\n   * InputChange Handler\n   * @param e\n   */\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value;\n    updateValue(value);\n    updateMatchedDataSource(value);\n  };\n\n  /**\n   * KeyDown Handler\n   * deal with `Tab` | `Enter` | `ArrowUp` | `ArrowDown`\n   * @param e\n   */\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (Object.values(KeyEnum).includes(e.key as KeyEnum)) {\n      e.preventDefault();\n    }\n\n    switch (e.key) {\n      case KeyEnum.TAB:\n        const matchedDataSourceItem = matchedDataSource?.[activeIndex];\n        if (!matchedDataSourceItem) return;\n\n        /**\n         * onChange >>> onSelect >>> Search matched item\n         */\n        const { text } = matchedDataSourceItem;\n        updateValue(text);\n        onSelect && onSelect(matchedDataSourceItem);\n        updateMatchedDataSource(text);\n        break;\n      case KeyEnum.ENTER:\n        /**\n         * onPressEnter >>> Reset\n         */\n        onPressEnter && onPressEnter(ctrlValue);\n        updateMatchedDataSource();\n        break;\n      case KeyEnum.ARROW_UP:\n        if (!navigate) break;\n\n        setActiveIndex((idx) => {\n          if (matchedDataSource?.length) {\n            return (idx - 1 + matchedDataSource.length) % matchedDataSource.length;\n          }\n          return 0;\n        });\n        break;\n      case KeyEnum.ARROW_DOWN:\n        if (!navigate) break;\n\n        setActiveIndex((idx) => {\n          if (matchedDataSource?.length) {\n            return (idx + 1) % matchedDataSource.length;\n          }\n          return 0;\n        });\n        break;\n      default:\n        break;\n    }\n  };\n\n  const breakUp = () => {\n    return matchedDataSource?.[activeIndex]?.text\n      ? `${ctrlValue}${matchedDataSource[activeIndex].text.slice(ctrlValue.length)}`\n      : undefined;\n  };\n\n  const wrapClassString = classNames('ria-wrap', styles.wrap, className); // `className` should cover `styles.wrap`\n  const inputClassString = classNames('ria-input', styles.input);\n  const completeClassString = classNames('ria-complete', styles.complete);\n  const completeContent = breakUp();\n\n  return (\n    <div className={wrapClassString}>\n      <input\n        ref={inputRef as any}\n        className={inputClassString}\n        value={ctrlValue}\n        type=\"text\"\n        onBlur={onBlur}\n        onFocus={onFocus}\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n        {...others}\n      />\n      <div className={completeClassString}>{completeContent}</div>\n    </div>\n  );\n};\n\nconst RefAutoComplete = React.forwardRef<HTMLInputElement, Props>(Autocomplete);\nexport default RefAutoComplete;\n"],"names":["KeyEnum","Autocomplete","props","ref","value","dataSource","className","navigate","caseSensitive","onBlur","onFocus","onChange","onPressEnter","onSelect","others","useState","innerVal","setInnerVal","matchedDataSource","setMatchedDataSource","activeIndex","setActiveIndex","ctrlValue","inputRef","useRef","React","useImperativeHandle","current","updateValue","updateMatchedDataSource","filter","text","startsWith","ignoreCase","equals","handleChange","e","target","handleKeyDown","Object","values","includes","key","preventDefault","TAB","matchedDataSourceItem","ENTER","ARROW_UP","idx","length","ARROW_DOWN","breakUp","slice","undefined","wrapClassString","classNames","styles","wrap","inputClassString","input","completeClassString","complete","completeContent","type","onKeyDown","RefAutoComplete","forwardRef"],"mappings":"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"}