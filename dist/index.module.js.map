{"version":3,"file":"index.module.js","sources":["../lib/key-enum.ts","../lib/index.tsx"],"sourcesContent":["export enum KeyEnum {\r\n  TAB = 'Tab',\r\n  ENTER = 'Enter',\r\n  ARROW_UP = 'ArrowUp',\r\n  ARROW_DOWN = 'ArrowDown',\r\n}\r\n","import React, { useRef, useState } from 'react';\r\nimport classNames from 'classnames';\r\nimport ignoreCase from 'ignore-case';\r\nimport { KeyEnum } from './key-enum';\r\nimport styles from './index.module.css';\r\n\r\nexport interface Props {\r\n  value?: string;\r\n  dataSource: DataSourceItem[];\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n  placeholder?: string;\r\n  disabled?: boolean;\r\n  navigate?: boolean;\r\n  caseSensitive?: boolean;\r\n  onBlur?: () => void;\r\n  onFocus?: () => void;\r\n  onChange?: (value: string) => void;\r\n  onPressEnter?: (value: string) => void;\r\n  onSelect?: (item: DataSourceItem) => void;\r\n}\r\n\r\nexport interface DataSourceItem {\r\n  text: string;\r\n  value: string | number;\r\n  [key: string]: any;\r\n}\r\n\r\nconst Autocomplete: React.ForwardRefRenderFunction<HTMLInputElement, Props> = (props, ref) => {\r\n  const {\r\n    value,\r\n    dataSource,\r\n    className,\r\n    navigate = true,\r\n    caseSensitive = true,\r\n    onBlur,\r\n    onFocus,\r\n    onChange,\r\n    onPressEnter,\r\n    onSelect,\r\n    ...others\r\n  } = props;\r\n  const [innerVal, setInnerVal] = useState('');\r\n  const [matchedDataSource, setMatchedDataSource] = useState<DataSourceItem[]>();\r\n  const [activeIndex, setActiveIndex] = useState(0);\r\n  const ctrlValue = value ?? innerVal;\r\n\r\n  /**\r\n   * inputRef\r\n   */\r\n  const inputRef = useRef<HTMLInputElement>();\r\n  React.useImperativeHandle(ref, () => inputRef.current!);\r\n\r\n  const updateValue = (value: string) => {\r\n    onChange && onChange(value);\r\n    setInnerVal(value);\r\n  };\r\n\r\n  const updateMatchedDataSource = (value?: string) => {\r\n    setActiveIndex(0);\r\n    value\r\n      ? setMatchedDataSource(\r\n          dataSource.filter(({ text }) => {\r\n            return caseSensitive\r\n              ? text.startsWith(value) && text !== value\r\n              : ignoreCase.startsWith(text, value) && !ignoreCase.equals(text, value);\r\n          })\r\n        )\r\n      : setMatchedDataSource([]);\r\n  };\r\n\r\n  /**\r\n   * InputChange Handler\r\n   * @param e\r\n   */\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = e.target.value;\r\n    updateValue(value);\r\n    updateMatchedDataSource(value);\r\n  };\r\n\r\n  /**\r\n   * KeyDown Handler\r\n   * deal with `Tab` | `Enter` | `ArrowUp` | `ArrowDown`\r\n   * @param e\r\n   */\r\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (Object.values(KeyEnum).includes(e.key as KeyEnum)) {\r\n      e.preventDefault();\r\n    }\r\n\r\n    switch (e.key) {\r\n      case KeyEnum.TAB:\r\n        const matchedDataSourceItem = matchedDataSource?.[activeIndex];\r\n        if (!matchedDataSourceItem) return;\r\n\r\n        /**\r\n         * onChange >>> onSelect >>> Search matched item\r\n         */\r\n        const { text } = matchedDataSourceItem;\r\n        updateValue(text);\r\n        onSelect && onSelect(matchedDataSourceItem);\r\n        updateMatchedDataSource(text);\r\n        break;\r\n      case KeyEnum.ENTER:\r\n        /**\r\n         * onPressEnter >>> Reset\r\n         */\r\n        onPressEnter && onPressEnter(ctrlValue);\r\n        updateMatchedDataSource();\r\n        break;\r\n      case KeyEnum.ARROW_UP:\r\n        if (!navigate) break;\r\n\r\n        setActiveIndex((idx) => {\r\n          if (matchedDataSource?.length) {\r\n            return (idx - 1 + matchedDataSource.length) % matchedDataSource.length;\r\n          }\r\n          return 0;\r\n        });\r\n        break;\r\n      case KeyEnum.ARROW_DOWN:\r\n        if (!navigate) break;\r\n\r\n        setActiveIndex((idx) => {\r\n          if (matchedDataSource?.length) {\r\n            return (idx + 1) % matchedDataSource.length;\r\n          }\r\n          return 0;\r\n        });\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  };\r\n\r\n  const breakUp = () => {\r\n    return matchedDataSource?.[activeIndex]?.text\r\n      ? `${ctrlValue}${matchedDataSource[activeIndex].text.slice(ctrlValue.length)}`\r\n      : undefined;\r\n  };\r\n\r\n  const wrapClassString = classNames('ria-wrap', styles.wrap, className); // `className` should cover `styles.wrap`\r\n  const inputClassString = classNames('ria-input', styles.input);\r\n  const completeClassString = classNames('ria-complete', styles.complete);\r\n  const completeContent = breakUp();\r\n\r\n  return (\r\n    <div className={wrapClassString}>\r\n      <input\r\n        ref={inputRef as any}\r\n        className={inputClassString}\r\n        value={ctrlValue}\r\n        type=\"text\"\r\n        onBlur={onBlur}\r\n        onFocus={onFocus}\r\n        onChange={handleChange}\r\n        onKeyDown={handleKeyDown}\r\n        {...others}\r\n      />\r\n      <div className={completeClassString}>{completeContent}</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst RefAutoComplete = React.forwardRef<HTMLInputElement, Props>(Autocomplete);\r\nexport default RefAutoComplete;\r\n"],"names":["KeyEnum","Autocomplete","props","ref","value","dataSource","className","_props$navigate","navigate","_props$caseSensitive","caseSensitive","onBlur","onFocus","onChange","onPressEnter","onSelect","others","_objectWithoutPropertiesLoose","_excluded","_useState","useState","innerVal","setInnerVal","_useState2","matchedDataSource","setMatchedDataSource","_useState3","activeIndex","setActiveIndex","ctrlValue","inputRef","useRef","React","useImperativeHandle","current","updateValue","updateMatchedDataSource","filter","_ref","text","startsWith","ignoreCase","equals","handleChange","e","target","handleKeyDown","Object","values","includes","key","preventDefault","TAB","matchedDataSourceItem","ENTER","ARROW_UP","idx","length","ARROW_DOWN","breakUp","_matchedDataSource$ac","slice","undefined","wrapClassString","classNames","styles","wrap","inputClassString","input","completeClassString","complete","completeContent","type","onKeyDown","RefAutoComplete","forwardRef"],"mappings":"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"}